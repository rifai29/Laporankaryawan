<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alfamidi HR - Soft Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #c1121c; 
            --accent: #ffcf00; 
            --bg: #f8fafc; 
            --text-dark: #1e293b;
            --border-light: #e2e8f0;
            --success: #10b981;
        }
        
        body { 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            background: var(--bg); 
            color: var(--text-dark); 
            padding-bottom: 40px; 
        }

        /* Header */
        .navbar { 
            background: white; height: 65px; display: flex; align-items: center; 
            padding: 0 20px; position: fixed; top: 0; width: 100%; z-index: 1000; 
            box-sizing: border-box; border-bottom: 1px solid var(--border-light); 
            justify-content: space-between;
        }
        .brand { font-weight: 700; color: var(--primary); letter-spacing: -0.5px; }

        .container { padding: 85px 16px 20px; max-width: 500px; margin: auto; }

        /* Cards & Stats */
        .stats-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-card { 
            background: white; padding: 16px; border-radius: 12px; 
            border-top: 4px solid var(--primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        .stat-val { font-size: 24px; font-weight: 700; color: var(--text-dark); display: block; }
        .stat-lab { font-size: 11px; font-weight: 600; color: #64748b; text-transform: uppercase; }

        .main-card { 
            background: white; border-radius: 12px; padding: 20px; 
            border-top: 4px solid var(--primary); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        /* Inputs */
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; font-weight: 700; margin-bottom: 6px; color: #475569; }
        input { 
            width: 100%; padding: 12px; border: 1px solid var(--border-light); 
            border-radius: 8px; box-sizing: border-box; font-size: 14px; 
            background: #fdfdfd; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; background: white; }

        /* Nav List */
        .nav-list { background: white; border-radius: 12px; overflow: hidden; border: 1px solid var(--border-light); }
        .nav-item { 
            display: flex; justify-content: space-between; align-items: center;
            padding: 16px; border-bottom: 1px solid var(--border-light);
            cursor: pointer; transition: 0.2s;
        }
        .nav-item:last-child { border-bottom: none; }
        .nav-item:active { background: #f1f5f9; }
        .nav-text { font-weight: 700; font-size: 14px; }
        .chevron { color: #cbd5e1; font-size: 14px; }

        /* Scroll Table */
        .scroll-container { 
            background: white; border-radius: 12px; max-height: 200px; 
            overflow-y: auto; margin-top: 15px; border: 1px solid var(--border-light);
        }
        table { width: 100%; border-collapse: collapse; }
        th { position: sticky; top: 0; background: #f8fafc; padding: 12px; text-align: left; font-size: 11px; font-weight: 700; color: #64748b; border-bottom: 1px solid var(--border-light); }
        td { padding: 12px; font-size: 13px; border-bottom: 1px solid #f1f5f9; color: #334155; }

        .btn-primary { 
            background: var(--primary); color: white; border: none; 
            padding: 14px; border-radius: 8px; width: 100%; 
            font-weight: 700; cursor: pointer; margin-top: 5px;
        }

        /* CUSTOM MODAL (CONFIRMATION) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); display: none; align-items: center;
            justify-content: center; z-index: 3000; padding: 20px; box-sizing: border-box;
        }
        .modal-content {
            background: white; padding: 24px; border-radius: 16px; width: 100%;
            max-width: 320px; text-align: center; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
        }
        .modal-title { font-weight: 700; font-size: 18px; margin-bottom: 10px; }
        .modal-desc { font-size: 14px; color: #64748b; margin-bottom: 20px; line-height: 1.5; }
        .modal-buttons { display: flex; gap: 10px; }
        .btn-modal { flex: 1; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; font-size: 14px; }
        .btn-cancel { background: #f1f5f9; color: #475569; }
        .btn-confirm { background: var(--primary); color: white; }

        /* Toast */
        #toast {
            visibility: hidden; min-width: 200px; background: #333; color: white;
            text-align: center; border-radius: 10px; padding: 14px; position: fixed;
            z-index: 4000; left: 50%; bottom: 30px; transform: translateX(-50%);
            font-size: 13px; font-weight: 600;
        }
        #toast.show { visibility: visible; animation: fadeInUp 0.5s; }
        #toast.success { background: var(--success); }
    </style>
</head>
<body>

<nav class="navbar">
    <div class="brand">HR</div>
    <div style="font-size: 12px; font-weight: 600; color: #94a3b8;">v1.0.4</div>
</nav>

<div class="container">
    <div class="stats-row">
        <div class="stat-card">
            <span class="stat-lab">Total Staff</span>
            <span class="stat-val" id="countTotal">0</span>
        </div>
        <div class="stat-card">
            <span class="stat-lab">Baru</span>
            <span class="stat-val" id="countNew">0</span>
        </div>
    </div>

    <div class="main-card">
        <div class="input-group">
            <label>NIK KARYAWAN</label>
            <input type="number" id="nik" placeholder="0225..." oninput="hitungMasaKerja()">
        </div>
        <div class="input-group">
            <label>NAMA LENGKAP</label>
            <input type="text" id="nama" placeholder="Sesuai ID Card">
        </div>
        <div class="input-group">
            <label>MASA KERJA</label>
            <input type="text" id="masaKerja" readonly style="color: var(--primary); font-weight: 700;">
        </div>
        <button class="btn-primary" onclick="simpanData()">SIMPAN DATA</button>
    </div>

    <div class="nav-list">
        <div class="nav-item" onclick="openExportModal()">
            <span class="nav-text">Unduh Laporan (CSV)</span>
            <span class="chevron">❯</span>
        </div>
        <label class="nav-item" for="importCsv">
            <span class="nav-text">Impor Data Excel (CSV)</span>
            <span class="chevron">❯</span>
            <input type="file" id="importCsv" accept=".csv" style="display: none;" onchange="imporData(this)">
        </label>
    </div>

    <div class="scroll-container">
        <table id="tabelKaryawan">
            <thead>
                <tr>
                    <th>NIK</th>
                    <th>NAMA</th>
                    <th>MASA</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<div class="modal-overlay" id="modalExport">
    <div class="modal-content">
        <div class="modal-title">Konfirmasi Unduh</div>
        <div class="modal-desc">Apakah Anda yakin ingin mengunduh semua data karyawan dalam format CSV?</div>
        <div class="modal-buttons">
            <button class="btn-modal btn-cancel" onclick="closeModal()">Batal</button>
            <button class="btn-modal btn-confirm" onclick="konfirmasiEkspor()">Ya, Unduh</button>
        </div>
    </div>
</div>

<div id="toast"></div>

<script>
    let db = JSON.parse(localStorage.getItem('midi_hr_v1')) || [];

    function showToast(msg, type="success") {
        const t = document.getElementById("toast");
        t.innerText = msg;
        t.className = "show " + type;
        setTimeout(() => { t.className = ""; }, 3000);
    }

    /* Modal Logic */
    function openExportModal() {
        if(db.length === 0) return showToast("Tidak ada data!", "error");
        document.getElementById('modalExport').style.display = 'flex';
    }
    function closeModal() {
        document.getElementById('modalExport').style.display = 'none';
    }
    function konfirmasiEkspor() {
        closeModal();
        eksporExcel();
    }

    /* Logic Fitur */
    function hitungMasaKerja() {
        const nik = document.getElementById('nik').value;
        const out = document.getElementById('masaKerja');
        if (nik.length >= 6) {
            const thn = parseInt("20" + nik.substring(2, 4));
            const bln = parseInt(nik.substring(4, 6));
            const sekarang = new Date(2026, 0); 
            const masuk = new Date(thn, bln - 1);
            const totalBln = (sekarang.getFullYear() - masuk.getFullYear()) * 12 + (sekarang.getMonth() - masuk.getMonth());
            out.value = totalBln < 0 ? "Belum Masuk" : `${Math.floor(totalBln/12)} Thn ${totalBln%12} Bln`;
        } else { out.value = ""; }
    }

    function simpanData() {
        const nik = document.getElementById('nik').value;
        const nama = document.getElementById('nama').value;
        const masa = document.getElementById('masaKerja').value;
        if(!nik || !nama) return showToast("Lengkapi form!", "error");
        
        db.unshift({ nik, nama, masa, thnMasuk: nik.substring(2,4) });
        localStorage.setItem('midi_hr_v1', JSON.stringify(db));
        showToast("Data Tersimpan");
        render();
        document.querySelectorAll('input').forEach(i => i.value = '');
    }

    function render() {
        const tbody = document.querySelector('#tabelKaryawan tbody');
        tbody.innerHTML = db.map(i => `<tr>
            <td style="font-family:monospace; font-weight:600">${i.nik}</td>
            <td style="text-transform:uppercase">${i.nama}</td>
            <td>${i.masa}</td>
        </tr>`).join('');
        document.getElementById('countTotal').innerText = db.length;
        document.getElementById('countNew').innerText = db.filter(k => k.thnMasuk === '25' || k.thnMasuk === '26').length;
    }

    function eksporExcel() {
        let csv = "NIK,Nama,Masa Kerja\n";
        db.forEach(i => { csv += `${i.nik},${i.nama},${i.masa}\n`; });
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'Laporan_Midi_HR.csv';
        a.click();
        showToast("Laporan Diunduh");
    }

    // Fungsi Impor Data
    function imporData(input) {
        const file = input.files[0];
        const reader = new FileReader();
        reader.onload = function(e) {
            const lines = e.target.result.split('\n');
            for(let i = 1; i < lines.length; i++) {
                const cols = lines[i].split(',');
                if(cols.length >= 2) {
                    db.unshift({ nik: cols[0], nama: cols[1], masa: cols[2] || '-', thnMasuk: cols[0].substring(2,4) });
                }
            }
            localStorage.setItem('midi_hr_v1', JSON.stringify(db));
            render();
            showToast("Impor Berhasil!");
        };
        reader.readAsText(file);
    }

    render();
</script>

</body>
</html>
